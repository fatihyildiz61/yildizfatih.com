---

// ThemeProvider.astro - Enhanced theme management with better performance and features
---
<nav class="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-slate-200/50 dark:border-slate-700/50 transition-all duration-500" role="navigation" aria-label="Ana navigasyon">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      
      <!-- Enhanced Logo & Brand -->
      <div class="flex items-center">
        <a href="/" class="flex items-center gap-3 group" aria-label="Ana sayfaya git - Fatih Yıldız Portfolio">
          <div class="relative">
            <!-- Logo - SVG formatında -->
            <img src="/logo.svg" alt="Fatih Yıldız Logo" class="h-8 w-8 transition-transform duration-300 group-hover:scale-110 dark:invert" />
            <div class="absolute inset-0 bg-blue-500/20 rounded-full blur-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300" aria-hidden="true"></div>
          </div>
          <span class="font-display text-xl font-bold tracking-tight text-slate-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-500">
            Fatih Yıldız
          </span>
        </a>
      </div>

      <!-- Enhanced Desktop Navigation with Active States -->
      <div class="hidden md:flex items-center gap-8" id="desktop-nav" role="menubar">
        <a href="/#portfolio" class="nav-link relative text-sm font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-500 group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-section="portfolio" role="menuitem" aria-label="Portföy bölümüne git">
          Portföy
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 dark:bg-blue-400 transition-all duration-500 group-hover:w-full" aria-hidden="true"></span>
        </a>
        <a href="/#about" class="nav-link relative text-sm font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-500 group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-section="about" role="menuitem" aria-label="Hakkımda bölümüne git">
          Hakkımda
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 dark:bg-blue-400 transition-all duration-500 group-hover:w-full" aria-hidden="true"></span>
        </a>
        <a href="/#contact" class="nav-link relative text-sm font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-500 group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-section="contact" role="menuitem" aria-label="İletişim bölümüne git">
          İletişim
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 dark:bg-blue-400 transition-all duration-500 group-hover:w-full" aria-hidden="true"></span>
        </a>
        <!-- Projects link for project pages -->
        <a href="/projects" class="nav-link relative text-sm font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-500 group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-section="projects" role="menuitem" aria-label="Tüm projeleri görüntüle">
          Tüm Projeler
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 dark:bg-blue-400 transition-all duration-500 group-hover:w-full" aria-hidden="true"></span>
        </a>
      </div>

      <!-- Right Side Actions -->
      <div class="hidden md:flex items-center gap-4" id="desktop-actions">

        
        <!-- Enhanced Theme Toggle -->
        <div class="theme-toggle-container relative" data-theme-aware>
          <button 
            id="theme-toggle-btn"
            class="theme-switch relative inline-flex h-7 w-12 items-center rounded-full bg-slate-300 dark:bg-slate-600 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900 hover:shadow-lg border border-slate-200 dark:border-slate-500"
            aria-label="Tema değiştir (Açık/Koyu)"
            aria-pressed="false"
            title="Tema değiştir (Ctrl/Cmd + J)"
            role="switch"
            aria-checked="false"
          >
            <!-- Switch Thumb -->
            <div class="switch-thumb absolute left-0.5 h-6 w-6 rounded-full bg-white dark:bg-slate-200 shadow-md transition-all duration-300 ease-out flex items-center justify-center transform" aria-hidden="true">
              <!-- Sun Icon -->
              <svg class="sun-icon h-3.5 w-3.5 text-yellow-600 dark:opacity-0 dark:scale-0 transition-all duration-200" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
              </svg>
              
              <!-- Moon Icon -->
              <svg class="moon-icon absolute h-3.5 w-3.5 text-slate-700 opacity-0 scale-0 dark:opacity-100 dark:scale-100 transition-all duration-200" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
              </svg>
            </div>
          </button>
        </div>

        <!-- Enhanced CTA Button -->
        <a href="/#contact" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-all duration-500 transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" aria-label="İletişim formuna git">
          İletişime Geç
        </a>
      </div>

      <!-- Enhanced Mobile Menu Button -->
      <button 
        id="mobile-menu-button"
        class="md:hidden relative p-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 transition-all duration-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 group"
        aria-label="Mobil menüyü aç/kapat"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-haspopup="true"
      >
        <!-- Modern Hamburger Icon -->
        <div class="w-5 h-5 flex flex-col justify-center items-center" aria-hidden="true">
          <span class="w-4 h-0.5 bg-slate-600 dark:text-slate-400 transition-all duration-300 transform origin-center group-hover:bg-blue-600 dark:group-hover:bg-blue-400"></span>
          <span class="w-4 h-0.5 bg-slate-600 dark:text-slate-400 transition-all duration-300 transform origin-center mt-1 group-hover:bg-blue-600 dark:group-hover:bg-blue-400"></span>
          <span class="w-4 h-0.5 bg-slate-600 dark:text-slate-400 transition-all duration-300 transform origin-center mt-1 group-hover:bg-blue-600 dark:group-hover:bg-blue-400"></span>
        </div>
      </button>
    </div>

    <!-- Enhanced Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden border-t border-slate-200/50 dark:border-slate-700/50" role="menu" aria-labelledby="mobile-menu-button">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <a href="/#portfolio" class="mobile-nav-link block px-3 py-2 text-base font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-md transition-colors duration-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset" data-section="portfolio" role="menuitem" aria-label="Portföy bölümüne git">
          Portföy
        </a>
        <a href="/#about" class="mobile-nav-link block px-3 py-2 text-base font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-md transition-colors duration-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset" data-section="about" role="menuitem" aria-label="Hakkımda bölümüne git">
          Hakkımda
        </a>
        <a href="/#contact" class="mobile-nav-link block px-3 py-2 text-base font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-md transition-colors duration-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset" data-section="contact" role="menuitem" aria-label="İletişim bölümüne git">
          İletişim
        </a>
        <a href="/projects" class="mobile-nav-link block px-3 py-2 text-base font-medium text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-md transition-colors duration-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset" data-section="projects" role="menuitem" aria-label="Tüm projeleri görüntüle">
          Tüm Projeler
        </a>

        
        <div class="pt-4 pb-3 border-t border-slate-200/50 dark:border-slate-700/50">
          <a href="/#contact" class="block px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-base font-medium rounded-md transition-colors duration-500 text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset" role="menuitem" aria-label="İletişim formuna git">
            İletişime Geç
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Enhanced theme toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggleBtn = document.getElementById('theme-toggle-btn');
      const switchThumb = document.querySelector('.switch-thumb');
      
      if (themeToggleBtn && switchThumb) {
        themeToggleBtn.addEventListener('click', function() {
          if (window.themeUtils) {
            window.themeUtils.toggleTheme();
          } else {
            // Fallback theme toggle
            const isDark = document.documentElement.classList.contains('dark');
            const newTheme = isDark ? 'light' : 'dark';
            
            try {
              localStorage.setItem('theme', newTheme);
            } catch (e) {
              console.warn('Could not save theme preference:', e);
            }
            
            document.documentElement.classList.toggle('dark', newTheme === 'dark');
            
            // Update switch visual state immediately
            updateSwitchPosition(newTheme === 'dark');
          }
        });
      }
      
      // Update switch position function
      function updateSwitchPosition(isDark) {
        if (!switchThumb) return;
        
        if (isDark) {
          // Dark mode - move to right
          switchThumb.style.transform = 'translateX(1.25rem)';
        } else {
          // Light mode - move to left
          switchThumb.style.transform = 'translateX(0)';
        }
      }
      
      // Initialize switch state on load
      const initTheme = () => {
        const isDark = document.documentElement.classList.contains('dark') || 
                      localStorage.getItem('theme') === 'dark' ||
                      (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
        
        document.documentElement.classList.toggle('dark', isDark);
        updateSwitchPosition(isDark);
      };
      
      // Initialize on load
      initTheme();
      
      // Listen for external theme changes
      window.addEventListener('themechange', (event) => {
        const newTheme = event.detail.theme;
        const newIsDark = newTheme === 'dark';
        updateSwitchPosition(newIsDark);
      });
    });

    // Enhanced mobile menu functionality with navbar hiding
    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const button = document.getElementById('mobile-menu-button');
      const desktopNav = document.getElementById('desktop-nav');
      const desktopActions = document.getElementById('desktop-actions');
      const isOpen = menu.classList.contains('hidden');
      
      if (isOpen) {
        // Open mobile menu
        menu.classList.remove('hidden');
        button.setAttribute('aria-expanded', 'true');
        
        // Hide desktop navigation elements on mobile
        if (window.innerWidth < 768) { // md breakpoint
          if (desktopNav) desktopNav.classList.add('hidden');
          if (desktopActions) desktopActions.classList.add('hidden');
        }
        
        // Add slide down animation
        menu.style.animation = 'slideDown 0.3s ease-out';
      } else {
        // Close mobile menu
        menu.classList.add('hidden');
        button.setAttribute('aria-expanded', 'false');
        
        // Show desktop navigation elements
        if (desktopNav) desktopNav.classList.remove('hidden');
        if (desktopActions) desktopActions.classList.remove('hidden');
      }
    }

    // Make toggleMobileMenu globally available
    window.toggleMobileMenu = toggleMobileMenu;

    // Add click event listener to mobile menu button
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      if (mobileMenuButton) {
        mobileMenuButton.addEventListener('click', toggleMobileMenu);
      }
      
      // Add active state detection
      detectActiveSection();
      
      // Add scroll detection for active section
      setupScrollDetection();
    });
    
    // Function to detect and highlight active section - DÜZELTİLDİ
    function detectActiveSection() {
      const currentPath = window.location.pathname;
      const currentHash = window.location.hash;
      const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
      
      // Eğer ana sayfada değilsek, scroll detection kullanma
      if (currentPath !== '/') {
        navLinks.forEach(link => {
          link.classList.remove('active');
          const section = link.getAttribute('data-section');
          
          if (currentPath === '/projects' && section === 'projects') {
            link.classList.add('active');
          } else if (currentPath.startsWith('/work/') && section === 'projects') {
            link.classList.add('active');
          }
        });
        return;
      }
      
      // Ana sayfa için scroll detection kullan
      updateActiveSectionOnScroll();
    }
    
    // Scroll detection setup - YENİ EKLENDİ
    function setupScrollDetection() {
      const currentPath = window.location.pathname;
      
      // Sadece ana sayfada scroll detection aktif olsun
      if (currentPath === '/') {
        window.addEventListener('scroll', throttle(updateActiveSectionOnScroll, 100));
      }
    }
    
    // Update active section based on scroll position - YENİ EKLENDİ
    function updateActiveSectionOnScroll() {
      const sections = ['portfolio', 'about', 'contact'];
      const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
      
      // Tüm linklerden active class'ı kaldır
      navLinks.forEach(link => {
        link.classList.remove('active');
      });
      
      // Scroll pozisyonuna göre hangi section'da olduğumuzu tespit et
      const scrollPosition = window.scrollY + 100; // Offset for better detection
      
      for (let i = sections.length - 1; i >= 0; i--) {
        const section = document.getElementById(sections[i]);
        if (section) {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;
          
          if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
            // Bu section'da olduğumuzu tespit ettik
            const activeLink = document.querySelector(`[data-section="${sections[i]}"]`);
            if (activeLink) {
              activeLink.classList.add('active');
            }
            break;
          }
        }
      }
    }
    
    // Throttle function for performance - YENİ EKLENDİ
    function throttle(func, limit) {
      let inThrottle;
      return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
          func.apply(context, args);
          inThrottle = true;
          setTimeout(() => inThrottle = false, limit);
        }
      }
    }
    
    // Listen for hash changes to update active state
    window.addEventListener('hashchange', detectActiveSection);
    
    // Listen for popstate (back/forward button)
    window.addEventListener('popstate', detectActiveSection);
  </script>
</nav>

<!-- Spacer for fixed navbar -->
<div class="h-16"></div>

<style>
  /* Enhanced switch toggle styles for Nav component */
  .theme-toggle-container {
    position: relative;
  }
  
  /* Modern switch toggle styles */
  .theme-toggle-container {
    position: relative;
  }
  
  /* Switch styles */
  .theme-switch {
    position: relative;
    cursor: pointer;
    overflow: hidden;
  }
  
  .theme-switch:focus {
    outline: none;
  }
  
  /* Switch thumb positioning */
  .switch-thumb {
    transform: translateX(0);
  }
  
  /* Dark mode thumb position */
  .dark .switch-thumb {
    transform: translateX(1.25rem);
  }
  
  /* Smooth transitions */
  .theme-switch,
  .switch-thumb {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Icon transitions */
  .sun-icon,
  .moon-icon {
    transition: all 0.2s ease-in-out;
  }
  
  /* Enhanced hover effects */
  .theme-switch:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  .dark .theme-switch:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
  
  .theme-switch:active {
    transform: translateY(0);
  }
  
  /* Theme-aware elements */
  [data-theme-aware] {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }


  
  /* Active state styles */
  .nav-link.active,
  .mobile-nav-link.active {
    color: #2563eb !important; /* blue-600 */
  }
  
  .nav-link.active span,
  .mobile-nav-link.active span {
    width: 100% !important;
  }
  
  /* Mobile menu animations */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Enhanced mobile menu button hover */
  #mobile-menu-button:hover span {
    background-color: #2563eb !important;
  }
  
  .dark #mobile-menu-button:hover span {
    background-color: #60a5fa !important;
  }

  /* Enhanced mobile menu animations */
  #mobile-menu {
    transition: all 0.3s ease-out;
  }
  
  #mobile-menu.hidden {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
  }
  
  #mobile-menu:not(.hidden) {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  
  /* Slide down animation */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Responsive breakpoint test */
  @media (max-width: 767px) {
    #desktop-nav,
    #desktop-actions {
      display: none !important;
    }
    
    #mobile-menu-button {
      display: block !important;
    }
  }
  
  @media (min-width: 768px) {
    #desktop-nav,
    #desktop-actions {
      display: flex !important;
    }
    
    #mobile-menu-button {
      display: none !important;
    }
    
    #mobile-menu {
      display: none !important;
    }
  }
  
  /* Enhanced focus states */
  .focus-ring:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }
  
  /* Mobile menu button hover effects */
  #mobile-menu-button:hover {
    transform: scale(1.05);
  }
  
  /* Mobile menu link hover effects */
  .mobile-nav-link:hover {
    background-color: rgba(59, 130, 246, 0.1);
    transform: translateX(4px);
  }
</style>